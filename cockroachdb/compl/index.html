<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>CockroachDB</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="mio.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress-help"></div><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="cockroachdb">CockroachDB</h1><p>Pedro Rivera</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="id1">CockroachDB</h1><p>Base de datos tipo SQL escalable de alta disponibilidad y resilencia</p><img src="CockroachDB.png" width="600px"></img></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="como-lo-hacen">Como lo hacen?</h1><ul><li>Almacenamiento tipo llave valor almacenados en rangos</li><li>Los rangos contienen solo a una tabla y al llegar a 512MB se dividen</li><li>Los rangos se sincronizan a redundancia 3 por defecto</li><li>Las peticiones a cada rango se gestionan con el modelo de leaseholder</li><li>La sincronizacion de los rangos se hace a cargo de un nodo para cara rango</li></ul></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="capas">Capas</h1><ul><li>API SQL - servicio para externos</li><li>Transaccional - soporte para TX atomicas</li><li>Distribucion - abstraccion del rango</li><li>Replicacion - sincroniza rangos</li><li>Almacenamiento - operaciones I/O en discos</li></ul></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="envoltorios-para-lenguajes">Envoltorios para lenguajes</h1><p>El api SQL se basa en postgresql</p><img src="bindings_cockroachdb.png" width="700px"></img></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="montando-un-cluster-con-docker">Montando un cluster con docker</h1><p>Crear una red</p><pre class="highlight code bash">docker network create -d bridge roachnet</pre></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="iniciar-el-cluster">iniciar el cluster</h1><p>Nodo inicial que expone al servicio por el puerto 2657 y 8080</p><pre class="highlight code bash">docker run -d <span class="se">\
</span>--name<span class="o">=</span>roach1 <span class="se">\
</span>--hostname<span class="o">=</span>roach1 <span class="se">\
</span>--net<span class="o">=</span>roachnet <span class="se">\
</span>-p <span class="m">26257</span>:26257 -p <span class="m">8080</span>:8080  <span class="se">\
</span>-v <span class="s2">"</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/cockroach-data/roach1:/cockroach/cockroach-data"</span>  <span class="se">\
</span>cockroachdb/cockroach:v21.1.2 start <span class="se">\
</span>--insecure <span class="se">\
</span>--join<span class="o">=</span>roach1,roach2,roach3</pre></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="subir-nodos">subir nodos</h1><p>Nodos internos del cluster</p><pre class="highlight code bash">docker run -d <span class="se">\
</span>--name<span class="o">=</span>roach2 <span class="se">\
</span>--hostname<span class="o">=</span>roach2 <span class="se">\
</span>--net<span class="o">=</span>roachnet <span class="se">\
</span>-v <span class="s2">"</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/cockroach-data/roach2:/cockroach/cockroach-data"</span> <span class="se">\
</span>cockroachdb/cockroach:v21.1.2 start <span class="se">\
</span>--insecure <span class="se">\
</span>--join<span class="o">=</span>roach1,roach2,roach3</pre></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="iniciar-cluster-y-abrir-cliente">iniciar cluster y abrir cliente</h1><p>Hacer que el primer nodo establezca la conexion con los demas, y
desde el primer nodo se usa el cliente.</p><pre class="highlight code bash"><span class="c1"># iniciar cluster
</span>docker <span class="nb">exec</span> -it roach1 ./cockroach init --insecure
<span class="c1"># iniciar cliente
</span>docker <span class="nb">exec</span> -it roach1 ./cockroach sql --insecure</pre></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="bibliografia">Bibliografia</h1><ul><li>Montar un cluster local <a href="https://www.cockroachlabs.com/docs/v21.1/start-a-local-cluster-in-docker-mac.html">https://www.cockroachlabs.com/docs/v21.1/start-a-local-cluster-in-docker-mac.html</a></li><li>Curso interactivo cockroachdb <a href="https://www.cockroachlabs.com/docs/tutorials/build-a-python-app-with-cockroachdb-interactive">https://www.cockroachlabs.com/docs/tutorials/build-a-python-app-with-cockroachdb-interactive</a></li><li>Como funciona internamente: <a href="https://www.cockroachlabs.com/docs/stable/architecture/overview.html">https://www.cockroachlabs.com/docs/stable/architecture/overview.html</a></li></ul></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><p>Gracias</p></div></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>